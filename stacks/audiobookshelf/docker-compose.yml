services:
  audiobookshelf:
    container_name: audiobookshelf
    image: ghcr.io/advplyr/audiobookshelf:latest
    restart: always
    ports:
      - 13378:80
    volumes:
      - ${MEDIA_ROOT:-/mnt/data}/Media/Books/Audiobooks:/audiobooks # Monitored mount
      # - ${MEDIA_ROOT:-/mnt/data}/Media/Podcasts:/podcasts
      - ${DATA_ROOT}/audiobookshelf:/config
      - ${DATA_ROOT}/audiobookshelf/metadata:/metadata
    environment:
      - TZ=Australia/Perth
    healthcheck:
      # Test Audiobookshelf's primary media mount
      test: ["CMD-SHELL", "timeout 10s stat /audiobooks || exit 1"]
      interval: 30s
      timeout: 15s
      retries: 5
      start_period: 60s
    labels:
      - io.containers.autoupdate=registry
      # REQUIRED: Label for autoheal to find this container
      - autoheal=true
