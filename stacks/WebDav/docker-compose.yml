version: "3.8"

services:
  webdav:
    image: docker.io/ck98/webdav-nginx
    container_name: webdav
    ports:
      - "9090:80"
    volumes:
      # This is the mount point we will check
      - ${MEDIA_ROOT:-/mnt/data}/Life/Andy/Education/Zotero Library/:/var/webdav/public
    environment:
      WEBDAV_USERNAME: ${WEBDAV_USERNAME}
      WEBDAV_PASSWORD: ${WEBDAV_PASSWORD}
      # Rootless podman: PUID=0 maps to host user
      PUID: 0
      PGID: 0
      UMASK: "0000"
    restart: unless-stopped
    healthcheck:
      # The command to run to check health. 'stat' is a lightweight way
      # to check if a directory is accessible. If the NFS mount is stale,
      # this command will either fail or time out.
      test: ["CMD", "stat", "/var/webdav/public"]
      interval: 30s # How often to run the check
      timeout: 10s # How long to wait for the command to complete
      retries: 3 # How many consecutive failures to allow before marking as unhealthy
      start_period: 60s # Grace period for the container to start before checks begin
