# Proxmox template evaluation warning

## Warning (current)

```
evaluation warning: Obsolete option `proxmox.qemuConf.diskSize' is used. It was renamed to `virtualisation.diskSize'.
```

## Where it comes from

- `nixpkgs` module: `nixos/modules/virtualisation/proxmox-image.nix`
- The module imports a rename helper and then renders `config.proxmox.qemuConf`
  into `qemu-server.conf`, which accesses the renamed option and triggers the
  warning even when the old option is not set locally.

## Decision

- Accept the warning until upstream is fixed (no local patch).

## Draft PR (upstream, very tight)

Target repo:
- `https://github.com/NixOS/nixpkgs`

Target file:
- `nixos/modules/virtualisation/proxmox-image.nix`

Intent:
- Serialize only valid `qemu-server.conf` keys; `diskSize` now lives under
  `virtualisation.diskSize` and should not be emitted from `proxmox.qemuConf`.
  This avoids the rename warning at its source.

Minimal diff idea:
- Build the `qemu-server.conf` content from a “valid keys” attrset rather than
  the raw `cfg.qemuConf` (at minimum, exclude `diskSize`).

Example patch:

```nix
      cfgFile =
        fileName: properties:
        let
          filtered = lib.removeAttrs properties [ "diskSize" ];
        in
        pkgs.writeTextDir fileName ''
          # generated by NixOS
          ${lib.concatStrings (lib.mapAttrsToList cfgLine filtered)}
          #qmdump#map:virtio0:drive-virtio0:${virtio0Storage}:raw:
        '';
```

PR title (tight):
- `proxmox-image: drop diskSize from qemu-server.conf`

PR body (tight):
- `Serialize only valid qemu-server.conf keys; diskSize is handled via virtualisation.diskSize.`
- `Removes the rename warning without changing behavior.`

Steps to open the PR:
1. Fork `https://github.com/NixOS/nixpkgs`.
2. Create branch: `fix-proxmox-diskSize-warning`.
3. Apply the change in `nixos/modules/virtualisation/proxmox-image.nix`.
4. Run a basic check (keep it minimal):
   - `nix flake check` (or at least `nix eval .#nixosModules`).
5. Push branch and open PR against `NixOS/nixpkgs`.
